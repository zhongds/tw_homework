<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>

<body>
	<div class="cruise">
		<h2>Cruise</h2>
		<ul class='tabs'>
			<li><a href='#dashboard'>DASHBOARD</a></li>
			<li><a href='#my-cruise'>MY CRUISE</a></li>
			<li><a href="#agents">AGENTS</a></li>
			<li><a href="#help">HELP</a></li>
		</ul>
		<div class='tab-content'>
			<div class='tab-panel' id="dashboard">this is dashboard</div>
			<div class='tab-panel' id="my-cruise">this is my-cruise</div>
			<div class='tab-panel' id="agents">
				<div class="agent">
					<div class="content-header">
						<div class="inline-block">Agents</div>
						<span class="ellipse">All</span>
						<span class="ellipse">Physical</span>
						<span class="ellipse">Virtual</span>
					</div>
					<div class="content-body">
						<ul class="w70p br agents-list">
							<li class="">
								<span class="circle left"></span>
								<div class="left pl10">
									<div>
										<span class="pr15">02.tw.com</span>
										<span class="split">idle</span>
										<span class="split">192.168.1.2</span>
										<span class="split">/const/lib/cruise-agents</span>
									</div>
									<div>
										<a href='#' class='add-resources inline-block'>Specify Resources</a>
										<span class="split inline-block">Resources:</span>
										<ul class="resources"></ul>
									</div>
								</div>
							</li>
							<li class="">
								<span class="circle left"></span>
								<div class="left pl10">
									<div>
										<span class="pr15">02.tw.com</span>
										<span class="split">idle</span>
										<span class="split">192.168.1.2</span>
										<span class="split">/const/lib/cruise-agents</span>
									</div>
									<div>
										<a href='#' class='add-resources inline-block'>Specify Resources</a>
										<span class="split inline-block">Resources:</span>
										<ul class="resources"></ul>
									</div>
								</div>
							</li>
							<li class="">
								<span class="circle left"></span>
								<div class="left pl10">
									<div>
										<span class="pr15">02.tw.com</span>
										<span class="split">idle</span>
										<span class="split">192.168.1.2</span>
										<span class="split">/const/lib/cruise-agents</span>
									</div>
									<div>
										<a href='#' class='add-resources inline-block'>Specify Resources</a>
										<span class="split inline-block">Resources:</span>
										<ul class="resources"></ul>
									</div>
								</div>
							</li>
							<li class="">
								<span class="circle left"></span>
								<div class="left pl10">
									<div>
										<span class="pr15">02.tw.com</span>
										<span class="split">idle</span>
										<span class="split">192.168.1.2</span>
										<span class="split">/const/lib/cruise-agents</span>
									</div>
									<div>
										<a href='#' class='add-resources inline-block'>Specify Resources</a>
										<span class="split inline-block">Resources:</span>
										<ul class="resources"></ul>
									</div>
								</div>
							</li>
						</ul>
						<div id="popover" class="popover hide">
							<div class="arrow"></div>
							<p class="tip">(separate mutiple resources name with commas)</p>
							<input />
							<div class="pt5 pb5">
								<button id="save" class="w125 cursor">Add Resources</button>
								<button id="close" class="w65 cursor">Close</button>
							</div>
						</div>
						<div class="w30p h100p"></div>
					</div>
				</div>
			</div>
			<div class='tab-panel' id="help">this is help page</div>
		</div>
	</div>
	<script type="text/javascript">
		function siblings(el) {
			const a = []
			const p = el.parentNode.children
			for (let i = 0, pl = p.length; i < pl; i++) {
				if (p[i] !== el) a.push(p[i])
			}
			return a
		}
		function removeActiveClass(arr) {
			for (let el of arr) {
				el.classList.remove('active')
			}
		}

		const el = document.getElementsByClassName("tabs")[0]
		el.addEventListener("click", e => {
			e.target.parentNode.classList.add('active')
			removeActiveClass(siblings(e.target.parentNode))
			const targetId = e.target.getAttribute('href')
			const targetPanel = document.querySelector(targetId)
			targetPanel.classList.add('active')
			removeActiveClass(siblings(targetPanel))
		}, false)

		//show add resources popover
		const resourceElList = document.getElementsByClassName('add-resources')
		for (let resourceEl of resourceElList) {
			resourceEl.addEventListener('click', e => {
				const popoverElStyle = document.getElementById('popover').style
				const height = resourceEl.offsetTop + resourceEl.clientHeight + 21
				const strCss = `top:${height}px; display: block`
				popoverElStyle.cssText += strCss
				removeActiveClass(resourceElList)
				resourceEl.classList.add('active')
			}, false)
		}

		//close
		const closeEl = document.getElementById('close')
		closeEl.addEventListener("click", e => {
			const popoverElStyle = document.getElementById('popover').style
			popoverElStyle.cssText += 'display: none'
			document.querySelector('.add-resources.active').classList.remove('active')
		}, false)

		function splitWithCommas(str) {
			let arr = str.split(',')
			arr.map(val => {

			})
		}

		//save resources
		const saveEl = document.getElementById('save')
		saveEl.addEventListener("click", e => {
			const inputEL = document.querySelector('#popover>input')
			const arr = inputEL.value.split(',')
			const resourcesEL = document.querySelector('.add-resources.active').parentNode.lastChild

			for (let text of arr) {
				const node = document.createElement("li")         
				const textNode = document.createTextNode(text.trim())
				const closeIcon = document.createElement("span")
				node.appendChild(textNode)
				node.appendChild(closeIcon)
				closeIcon.addEventListener('click', e => {
					e.target.parentNode.parentNode.removeChild(e.target.parentNode)
				}, false)
				resourcesEL.appendChild(node)
			}
			const popoverEl = saveEl.parentNode.parentNode
			popoverEl.style.cssText += 'display: none'
			popoverEl.getElementsByTagName('input')[0].value = ''
		}, false)
	</script>
</body>

</html>